<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        {{ block "head-about" . }}
            <title>{{ if .Title }}{{ .Title }} :: {{ end }}Design Tech Tutoring</title>
        {{ end }}

        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-orange.min.css"> 
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        
        {{ block "head-firebase_init" . }}
            <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
            <script>
                // Initialize Firebase
                var config = {
                    apiKey: "AIzaSyAqL0CwH3s1FwnuxL2RwZBSEp5SOrqXLHc",
                    authDomain: "design-tech-tutoring.firebaseapp.com",
                    databaseURL: "https://design-tech-tutoring.firebaseio.com",
                    projectId: "design-tech-tutoring",
                    storageBucket: "design-tech-tutoring.appspot.com",
                    messagingSenderId: "967509109741"
                };
                firebase.initializeApp(config);
            </script>
        {{ end }}
    </head>

    <body>
        {{ block "body" . }}
            <!-- Always shows a header, even in smaller screens. -->
            <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
                <header class="mdl-layout__header">
                    <div class="mdl-layout__header-row">
                        {{ block "header-row-contents" . }}
                            <span class="mdl-layout-title">{{ .Title }}</span>

                            <div class="mdl-layout-spacer"></div>

                            <a id="user_icon_link" href="/login/">
                                <img id="user_icon_image" src="https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg" style="width: 40px; height: 40px; border-radius: 20px;">
                            </a>
                            <div id="user_icon_tooltip" class="mdl-tooltip" for="user_icon_link" style="">Log in!</div>
                        {{ end }}
                    </div>
                    </header>
                    <div class="mdl-layout__drawer">
                    <span class="mdl-layout-title">d.tech Tutoring</span>
                    <nav class="mdl-navigation">
                        <a class="mdl-navigation__link show-tutor" style="display: none" href="/settings/">Tutor Settings</a>
                        <a class="mdl-navigation__link show-auth" style="display: none" href="/request/">Request</a>
                        <a class="mdl-navigation__link" href="https://github.com/david476/Design-Tech-Tutoring">About</a>
                    </nav>
                </div>

                <main class="mdl-layout__content">
                    {{ block "main" . }}
                        
                    {{ end }}
                </main>
            </div>

            {{ block "body-scripts" . }}
                <script>
                    firebase.auth().onAuthStateChanged(function(user) {
                        if (user) {
                            var userId = user.uid;

                            //Validate tutor status, redirect if not allowed and show things.
                            return firebase.database().ref('/users/' + userId).once('value').then(function(userProps) {
                                if(userProps.val().isTutor) {
                                    var reqd = document.getElementsByClassName("show-auth");
                                    for (var i = 0; i < reqd.length; i++) {
                                        reqd[i].style.display = "initial";
                                    }
                                    reqd = document.getElementsByClassName("show-tutor");
                                    for (var i = 0; i < reqd.length; i++) {
                                        reqd[i].style.display = "initial";
                                    }
                                }else {
                                    {{ if eq .Params.auth "tutor" }}window.location.href = "/request/"{{ end }};
                                    var reqd = document.getElementsByClassName("show-auth");
                                    for (var i = 0; i < reqd.length; i++) {
                                        reqd[i].style.display = "initial";
                                    }
                                }

                                //Update picture.
                                document.getElementById("user_icon_tooltip").innerHTML = userProps.val().name + "<br>" + userProps.val().email;
                                document.getElementById("user_icon_image").src = userProps.val().photo;
                            });
                        } else {
                            {{ if .Params.auth }}window.location.href = "/login/"{{ end }};
                        }
                    });
                </script>
            {{ end }}
        {{ end }}
    </body>
</html>
